<script>
  const filters = {
    sale: true,
    sold: true,
    new: true,
  };

  const colorMap = {
    sale: 'rgba(0,128,0,0.3)',
    sold: 'rgba(255,0,0,0.3)',
    new: 'rgba(0,0,255,0.3)',
  };

  const map = L.map('map').setView([51.0158, -113.8615], 17);
  L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    maxZoom: 22,
    attribution: '&copy; OpenStreetMap contributors'
  }).addTo(map);

  // Image overlay
  const imageBounds = [
    [51.0133299, -113.8625999],
    [51.0162200, -113.8544791],
  ];
  const imageUrl = 'assets/img/about/grandhome.jpg';
  L.imageOverlay(imageUrl, imageBounds).addTo(map);

  const polygonLayers = {};
  let farmPolygons = {};

  function renderPolygons() {
    Object.entries(farmPolygons).forEach(([id, farm]) => {
      if (polygonLayers[id]) {
        map.removeLayer(polygonLayers[id]);
      }

      polygonLayers[id] = L.polygon(farm.coordinates, {
        color: 'black',
        weight: 0.5,
        fillColor: filters[farm.status] ? colorMap[farm.status] : 'transparent',
        fillOpacity: 1,
      }).addTo(map);
    });
  }

  function toggleFilter(status) {
    filters[status] = !filters[status];
    renderPolygons();
  }

  // Load JSON on page load using async/await
  window.addEventListener('DOMContentLoaded', async () => {
    try {
      const response = await fetch('https://babu26350.github.io/creation/poligons.json');
      farmPolygons = await response.json();
      renderPolygons();
    } catch (error) {
      console.error('Failed to load JSON:', error);
    }
  });
</script>
